<dialog id="bulk-preview-modal" class="modal">
    <div class="modal-box w-11/12 max-w-6xl">
        <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
            AI解析結果プレビュー ({{ items|length }}件)
        </h3>
        
        <div class="mb-4 flex flex-wrap gap-2 items-center justify-between">
            <div class="text-sm">
                <p>※ 内容を確認し、必要に応じて「編集」ボタンで修正してください。</p>
                <p>※ 「追加しない」ボタンで行を削除できます。</p>
                <p>※ ポケモンの名前をクリックすると登録済みの同じ名前のポケモンを確認できます。</p>
            </div>
            <div>
                {% if original_image_url %}
                <a href="{{ original_image_url }}" target="_blank" class="btn btn-sm btn-outline btn-info gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    元画像を確認
                </a>
                {% endif %}
            </div>
        </div>

        {# テーブルエリア #}
        <div class="overflow-x-auto w-full max-h-[60vh] border rounded-lg">
            <table class="table table-zebra w-full table-compact">
                <thead>
                    <tr>
                    <th class="w-20 text-center">画像</th>
                    <th class="w-40 text-center">名前</th>
                    <th class="w-24 text-center">カテゴリ</th>
                    <th class="text-center">詳細情報 (進化/種別/タイプ等)</th>
                    <th class="w-24 text-center">メモ</th>
                    <th class="w-24 text-center">操作</th>
                </tr>
                </thead>
                <tbody id="bulk-preview-tbody">
                    {% for item in items %}
                        {% include "cards/_bulk_register_preview_row.html" with item=item %}
                    {% endfor %}
                </tbody>
            </table>
        </div>

        {# アクションエリア #}
        <div class="modal-action mt-4 flex justify-between items-center">
            <span class="htmx-indicator" id="bulk-submit-indicator">
                <span class="loading loading-spinner"></span> 登録処理中...
            </span>
            <div class="flex gap-2">
                <button class="btn btn-warning"
                        hx-post="{% url 'cards:bulk_register_submit' %}"
                        hx-target="#dialog-target"
                        hx-indicator="#bulk-submit-indicator">
                    まとめて登録する
                </button>
                <button class="btn" onclick="document.getElementById('bulk-preview-modal').close()">登録をやめる</button>
            </div>
        </div>
    </div>
    <form method="dialog" class="modal-backdrop">
        <button>close</button>
    </form>
</dialog>

<script>
    (function() {
        const modal = document.getElementById('bulk-preview-modal');
        if (modal) {
            modal.showModal();
            
            modal.addEventListener('close', () => {
                const dialogTarget = document.getElementById('dialog-target');
                if (dialogTarget) {
                    dialogTarget.innerHTML = '';
                }
            });
        }
    })();
</script>

{# 編集モーダル表示用のコンテナ #}
<div id="bulk-edit-modal-container"></div>
{# 検索結果モーダル表示用のコンテナ #}
<div id="search-modal-container"></div>
{# 詳細モーダル表示用のコンテナ #}
<div id="card-detail-modal-container"></div>
